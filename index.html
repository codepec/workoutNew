<!doctype html>
<html lang="de" data-theme="dark">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Iron Insanity</title>
<meta name="theme-color" content="#0f172a">
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.ico">
<link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
<link rel="stylesheet" href="./styles/app.css">

<style>


h1{
  margin-top:50px;
  font-size:2rem;
  color:#22c55e;
  text-align:center;
  letter-spacing:1px;
}

.hero-card{
  background:#111827;
  border:2px solid #374151;
  border-radius:22px;
  padding:24px;
  max-width:420px;
  width:80%;
  text-align:center;
  box-shadow:0 10px 30px rgba(0,0,0,.5);
  margin-top:20px;
}

.label-card{
  background:rgba(34,197,94,0.1);
  border:2px solid #22c55e;
  border-radius:14px;
  padding:14px;
  margin-bottom:12px;
  font-weight:800;
  font-size:1.15rem;
}

.label-card.exercise{
  background:rgba(59,130,246,0.12);
  border:2px solid #60a5fa;
  color:#e5f0ff;
}

.progress-box{
  margin:10px 0;
  text-align:left;
}

.progress-bar{
  width:100%;
  height:12px;
  background:#1f2937;
  border-radius:999px;
  overflow:hidden;
}

.progress-fill{
  height:100%;
  background:#22c55e;
  width:0%;
  transition:.5s;
}

.train-grid{
  margin-top:14px;
}

.train-row{
  background:#020617;
  border:1px solid #1f2937;
  border-radius:14px;
  padding:14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-top:8px;
  font-weight:700;
  font-size:1rem;
}

.start-btn{
  background:#22c55e;
  color:black;
  font-weight:900;
  padding:18px;
  border:none;
  border-radius:16px;
  width:100%;
  margin-top:16px;
  cursor:pointer;
  font-size:1.15rem;
}

.start-btn.locked{
  background:#374151;
  color:#9ca3af;
  cursor:not-allowed;
}

.secondary-btn{
  background:#374151;
  color:white;
  padding:14px;
  border:none;
  border-radius:16px;
  width:100%;
  margin-top:10px;
  font-weight:700;
  font-size:1rem;
}

.small{
  font-size:.85rem;
  opacity:.7;
  margin-top:4px;
}

#weekProgressText,
#xpProgressText{
  color:#9ca3af;
  margin-bottom:6px;
  text-align:center;
}
</style>
</head>

<body>

<h1>IRON INSANITY</h1>

<div class="hero-card">

  <div class="label-card" id="rankBox"></div>

  <!-- XP PROGRESS -->
  <div class="progress-box">
    <div id="xpProgressText" class="small"></div>
    <div class="progress-bar">
      <div class="progress-fill" id="xpProgressFill"></div>
    </div>
  </div>

  <div class="label-card" id="weekLabel"></div>

  <!-- WEEK PROGRESS -->
  <div class="progress-box">
    <div id="weekProgressText" class="small"></div>
    <div class="progress-bar">
      <div class="progress-fill" id="weekProgressFill"></div>
    </div>
  </div>

  <div class="label-card exercise" id="missionBox"></div>

  <div id="trainGrid" class="train-grid"></div>

  <button class="start-btn" id="startBtn"></button>

  <button class="secondary-btn" onclick="goToPreview()">Vorschau</button>
  <button class="secondary-btn" onclick="goToHistory()">History</button>
  <button class="secondary-btn" onclick="changeWeek()">Woche wechseln</button>

</div>

<script>

/* =======================
   CONFIG
======================= */

const order=["Push","Pull","Legs"];
let week = parseInt(localStorage.getItem("selectedWeek")) || 1;
const MIN_PAUSE_HOURS=24;

/* =======================
   DATA
======================= */

const history=JSON.parse(localStorage.getItem("history")||"[]");
const totalXp=Number(localStorage.getItem("totalXp")||0);
const session=JSON.parse(localStorage.getItem("workoutSession")||"null");
const lastDay=localStorage.getItem("lastDay");

/* =======================
   RANK SYSTEM (8 RÃ„NGE)
======================= */

const RANKS = [];
const baseNames = [
  "Rekrut", "Krieger", "ZerstÃ¶rer", "Titan", "Warlord", "Champion",
  "Legende", "Brutalizer", "Kriegsherr", "Eroberer", "PhÃ¶nix", "Schattenlord",
  "Apokalypt", "Unsterblicher", "Gottkrieger", "Mythos", "Kosmokrat", "Ewiger"
];

const musclePrefixes = [
  "Muskel", "Bizeps", "Protein", "Hantel", "Dominator", "Kraft", 
  "Supersaurus", "Ripped", "Omega", "Alpha", "Mega", "Titan", "Colossus", 
  "Maximus", "Ultra", "Giga", "Krieg", "Power", "Flex", "Brawn"
];

// Erst die Grundstufen
for (let i = 0; i < baseNames.length; i++) {
  RANKS.push({ n: baseNames[i], xp: i === 0 ? 0 : Math.floor(Math.pow(i, 2) * 1200) });
}

// Dann die ultra-muskeligen RÃ¤nge
for (let i = 0; i < 82; i++) {
  const prefix = musclePrefixes[i % musclePrefixes.length];
  const suffix = ["Berserker","Panzer","Held","Koloss","Gott","Ãœbermensch","Rampage","Titan"][i % 8];
  const name = `${prefix}-${suffix}`;
  const xp = Math.floor(Math.pow(baseNames.length + i, 2) * 1500); // Steil wachsend
  RANKS.push({ n: name, xp });
}


function getRankData(xp){
  let current=RANKS[0];
  let next=null;

  for(let i=0;i<RANKS.length;i++){
    if(xp>=RANKS[i].xp){
      current=RANKS[i];
      next=RANKS[i+1]||null;
    }
  }
  return {current,next};
}

/* =======================
   XP MULTIPLIER
======================= */

function weekMult(w){
 if(w>=7) return 1.6;
 if(w>=5) return 1.4;
 if(w>=3) return 1.2;
 return 1.0;
}

/* =======================
   MISSIONS
======================= */

const MISSIONS={
 Push:"ðŸŽ¯ Brust & Trizeps sprengen",
 Pull:"ðŸŽ¯ RÃ¼cken & Bizeps zerstÃ¶ren",
 Legs:"ðŸŽ¯ UnterkÃ¶rper Kriegstag"
};

/* =======================
   RANK BOX + XP BAR
======================= */

const rankData=getRankData(totalXp);

rankBox.innerHTML=
`ðŸŽ– Rang: ${rankData.current.n}
<div class="small">
XP ${totalXp} â€¢ Wochenbonus x${weekMult(week)}
</div>`;

let xpPct=100;
let xpText="Max Rang erreicht";

if(rankData.next){
 const span=rankData.next.xp-rankData.current.xp;
 const gained=totalXp-rankData.current.xp;
 xpPct=Math.min(100,(gained/span)*100);
 xpText=`${totalXp} / ${rankData.next.xp} XP â†’ ${rankData.next.n}`;
}

xpProgressFill.style.width=xpPct+"%";
xpProgressText.innerText=xpText;

/* =======================
   WEEK PROGRESS
======================= */

weekLabel.innerText=`Woche ${week}`;

/* =======================
   AUTOMATISCH WEEK WECHSELN
======================= */

// history fÃ¼r aktuelle Woche filtern
const weekEntries = history.filter(e => e.week === week);
const done = new Set(weekEntries.map(e => e.day)).size;

// wenn alle 3 Trainings erledigt sind
if(done >= 3){
  const nextWeek = week + 1;
  week = nextWeek;
  localStorage.setItem("selectedWeek", nextWeek);
  weekLabel.innerText = `Woche ${week}`;
  weekProgressText.innerText = `0/3 Trainings erledigt`;
  weekProgressFill.style.width = "0%";
  alert(`âœ… Woche ${week - 1} abgeschlossen! Willkommen in Woche ${week}`);
}



/* =======================
   NEXT DAY
======================= */

function nextFrom(last){
 if(!last) return "Push";
 return order[(order.indexOf(last)+1)%3];
}

const nextDay=nextFrom(lastDay);

/* =======================
   COOLDOWN
======================= */

let cooldown=0;
const lastEntry=history.at(-1);

if(lastEntry){
 cooldown=
  lastEntry.end+
  MIN_PAUSE_HOURS*3600000-
  Date.now();
}

function hoursLeft(ms){
 const h=Math.floor(ms/3600000);
 const m=Math.floor((ms%3600000)/60000);
 return h+"h "+m+"m";
}

/* =======================
   MISSION BOX
======================= */

missionBox.innerText=MISSIONS[nextDay];

/* =======================
   TRAIN GRID
======================= */

trainGrid.innerHTML="";

order.forEach(day=>{
 let icon="ðŸ”’",txt="gesperrt";

 if(day===lastDay){
  icon="âœ…"; txt="abgeschlossen";
 }

 if(day===nextDay){
  if(cooldown<=0){
   icon="âœ…"; txt="abgeschlossen"
   icon="ðŸ”¥"; txt="bereitgestellt";
  } else {
   icon="â³"; txt=hoursLeft(cooldown);
  }
 }

 trainGrid.innerHTML+=
 `<div class="train-row">
   <div>${day}</div>
   <div>${icon} ${txt}</div>
  </div>`;
});

if(done===3){
 trainGrid.innerHTML+=
 `<div class="train-row">
   <div>Boss Workout</div>
   <div>ðŸ”¥ freigeschaltet</div>
  </div>`;
}

/* =======================
   START BUTTON
======================= */

if(session && session.finished===false){

 startBtn.innerText="Training fortsetzen";
 startBtn.onclick=
  ()=>location.href="./pages/cards.html";
}
else if(cooldown>0){

 startBtn.innerText=
  "â³ Regeneration "+hoursLeft(cooldown);

 startBtn.classList.add("locked");
 startBtn.disabled=true;
}
else{

 startBtn.innerText="ðŸš€ Mission starten";

 startBtn.onclick=()=>{
  localStorage.setItem(
   "workoutSession",
   JSON.stringify({
    week,
    day:nextDay,
    startedAt:Date.now(),
    finished:false,
    difficultyFactor:1
   })
  );

  location.href="./pages/cards.html";
 };
}

/* =======================
   NAV
======================= */

function goToPreview(){location.href="./pages/preview.html";}
function goToHistory(){location.href="./pages/history.html";}
function changeWeek(){location.href="./pages/week.html";}

</script>

</body>
</html>
