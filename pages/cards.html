<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<title>Iron Insanity ‚Äî Hardcore Workout</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="../manifest.json">
<meta name="theme-color" content="#0f172a">
<link rel="stylesheet" href="../styles/app.css">

<style>
/* ======================
   BASE
====================== */
body, html {
  margin:0;
  font-family: system-ui, Arial, sans-serif;
  background: linear-gradient(135deg, #0f172a, #020617);
  color:white;
  overflow-x:hidden;
}
.page { max-width:480px; margin:0 auto; padding-bottom:120px; }

/* ======================
   HERO / XP BAR
====================== */
.hero-bar {
  position: sticky;
  top:0;
  background:#111827;
  padding:12px 16px;
  z-index:10;
  border-bottom:1px solid #1f2937;
  display:flex; flex-direction:column; gap:6px;
}
.hero-bar .level {
  font-weight:900;
  font-size:1.3rem;
}
.hero-bar .xp-bar {
  width:100%;
  height:12px;
  background:#1f2937;
  border-radius:999px;
  overflow:hidden;
}
.hero-bar .xp-fill {
  height:100%;
  background:crimson;
  width:0%;
  transition: width .4s ease-in-out;
}

/* ======================
   CARD
====================== */
#cardContainer {
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  padding:24px 12px;
}

.card {
  width:100%;
  background:#111827;
  border-radius:20px;
  padding:22px;
  margin-bottom:20px;
  border:2px solid #374151;
  box-shadow:0 12px 40px rgba(0,0,0,.5);
  text-align:center;
  animation:slideIn 0.35s ease-out;
}

@keyframes slideIn {
  0%{opacity:0; transform:translateY(20px)}
  100%{opacity:1; transform:translateY(0)}
}

.exercise {
  font-size:1.6rem;
  font-weight:900;
  margin-bottom:12px;
  animation:pulse 1.8s ease-in-out infinite;
}

@keyframes pulse {
  0%,100%{transform:scale(1)}
  50%{transform:scale(1.05)}
}

.muscle-icon {
  width:140px;
  margin:16px auto;
  display:block;
  animation:heartbeat 1.5s ease-in-out infinite;
}
@keyframes heartbeat{
  0%,28%,70%,100%{transform:scale(1)}
  14%,42%{transform:scale(1.12)}
}

.set-box {
  font-weight:700;
  margin:10px 0;
  font-size:1.1rem;
}

.set-progress {
  width:100%;
  height:12px;
  background:#1f2937;
  border-radius:8px;
  overflow:hidden;
}
.set-progress-fill {
  height:100%;
  background:#22c55e;
  width:0%;
  transition: width .4s ease;
}

.info-grid {
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:10px;
  margin-top:16px;
}
.badge{
  background:#020617;
  border:1px solid #1f2937;
  border-radius:14px;
  padding:10px 6px;
  text-align:center;
}
.badge-label{
  font-size:.7rem;
  opacity:.6;
}
.badge-value{
  font-size:1.05rem;
  font-weight:800;
}

/* ======================
   ACHIEVEMENT POPUP
====================== */
.ach-popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:999;
  animation:fadeIn .25s ease;
}
.ach-popup.hidden{display:none;}
.ach-box{
  background:#111827;
  border:2px solid #22c55e;
  border-radius:22px;
  padding:28px;
  width:90%;
  max-width:420px;
  text-align:center;
  box-shadow:0 0 50px rgba(34,197,94,.5);
  animation:pop .35s ease;
}
.ach-title{
  font-size:1.5rem;
  font-weight:900;
  margin-bottom:16px;
  color:#22c55e;
}
.ach-item{
  background:#020617;
  border:1px solid #1f2937;
  border-radius:12px;
  padding:12px;
  margin-top:10px;
  font-weight:700;
}
@keyframes pop{
  from{transform:scale(.8);opacity:0}
  to{transform:scale(1);opacity:1}
}
@keyframes fadeIn{
  from{opacity:0}
  to{opacity:1}
}
</style>
</head>

<body>

<div class="hero-bar">
  <div class="level" id="levelDisplay">Level 1</div>
  <div class="xp-bar"><div class="xp-fill" id="xpFill"></div></div>
</div>

<div id="cardContainer"></div>

<!-- Achievement Popup -->
<div id="achPopup" class="ach-popup hidden">
  <div class="ach-box">
    <div class="ach-title">üèÜ Achievement freigeschaltet!</div>
    <div id="achList"></div>
    <button onclick="closeAchPopup()" class="primary">Nice!</button>
  </div>
</div>

<script src="../components/layout.js"></script>
<script>
loadLayout("../pages/cards.html","../pages/preview.html");
</script>

<script>
/* =========================
   SESSION + DATA
========================= */
const PROGRESS_KEY="workoutProgress";
let session = JSON.parse(localStorage.getItem("workoutSession"));
if(!session||session.finished){ location.href="../index.html"; }
if(!session.difficultyFactor) session.difficultyFactor=1.0;

const week=session.week;
const day=session.day;
document.title=`Iron Insanity ‚Äî Woche ${week} ‚Ä¢ ${day}`;

const ICONS={ Chest:"chest.svg", Back:"back.svg", Legs:"legs.svg", Shoulders:"shoulders.svg", Biceps:"biceps.svg", Triceps:"triceps.svg" };

let exercises=[], exIndex=0, setIndex=0;
let xpTotal=0;

/* =========================
   LOAD DATA
========================= */
async function loadData(){
  const res = await fetch("../data/data.json");
  const data = await res.json();
  exercises=data.weeks.find(w=>w.week===week)[day];
  showCard();
}
loadData();

/* =========================
   SHOW CARD
========================= */
function showCard(){
  const root=document.getElementById("cardContainer");
  root.innerHTML="";

  if(exIndex>=exercises.length){
    root.innerHTML=`
      <div class="card">
        <h2>üî• Workout beendet!</h2>
        <button class="primary" onclick="finish()">Beenden & XP speichern</button>
      </div>`;
    localStorage.removeItem(PROGRESS_KEY);
    return;
  }

  const ex=exercises[exIndex];
  const sets=Number(ex.sets)||1;
  const pause=Number(ex.pause)||0;

  const card=document.createElement("div");
  card.className="card";

  card.innerHTML=`<div class="exercise">${ex.exercise}</div>`;

  const img=document.createElement("img");
  img.src="../icons/"+(ICONS[ex.muscle]||"default.svg");
  img.className="muscle-icon";
  card.appendChild(img);

  card.innerHTML+=`<div class="set-box">Satz ${setIndex+1} / ${sets}</div>`;

  const prog=document.createElement("div");
  prog.className="set-progress";
  prog.innerHTML=`<div class="set-progress-fill" style="width:${(setIndex/sets)*100}%"></div>`;
  card.appendChild(prog);

  const grid=document.createElement("div");
  grid.className="info-grid";
  grid.innerHTML=`
    <div class="badge"><div class="badge-label">Wdh</div><div class="badge-value">${ex.repetitions}</div></div>
    <div class="badge"><div class="badge-label">Gewicht</div><div class="badge-value">${ex.weight} kg</div></div>
    <div class="badge"><div class="badge-label">Pause</div><div class="badge-value">${pause}s</div></div>
    <div class="badge"><div class="badge-label">XP</div><div class="badge-value">${ex.xp}</div></div>
  `;
  card.appendChild(grid);

  const btn=document.createElement("button");
  btn.className="primary";
  btn.innerText="Satz erledigt üí™";
  btn.onclick=()=>completeSet(sets,pause,ex.xp);
  card.appendChild(btn);

  root.appendChild(card);
  updateXpBar();
}

/* =========================
   COMPLETE SET
========================= */
function completeSet(sets,pause,xp){
  setIndex++;
  xpTotal += xp;
  if(setIndex>=sets){ exIndex++; setIndex=0; }
  showCard();
}

/* =========================
   XP BAR
========================= */
function updateXpBar(){
  const level=Math.floor(xpTotal/500)+1;
  const fill=Math.min((xpTotal%500)/500*100,100);
  document.getElementById("levelDisplay").innerText="Level "+level;
  document.getElementById("xpFill").style.width=fill+"%";
}

/* =========================
   FINISH WORKOUT
========================= */
function finish(){
  const hist = JSON.parse(localStorage.getItem("history")||"[]");
  session.finished=true;
  session.finishedAt=Date.now();
  const totalDuration=session.finishedAt-session.startedAt;

  const entry={ week:session.week, day:session.day, start:session.startedAt, end:session.finishedAt, duration:totalDuration, xp:xpTotal };
  hist.push(entry);
  localStorage.setItem("history",JSON.stringify(hist));
  localStorage.setItem("workoutSession",JSON.stringify(session));
  localStorage.setItem("totalXp",Number(localStorage.getItem("totalXp")||0)+xpTotal);

  alert("üî• Workout beendet! Gesamt-XP: "+xpTotal);
  location.href="../index.html";
}
</script>
</body>
</html>
